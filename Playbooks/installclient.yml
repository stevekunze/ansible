---
- hosts: 127.0.0.1
  tasks:
    - name: required libraries for brave
      become: true
      apt:
        name: ["curl", "apt-transport-https"]

    - name: Brave Browser archive-keyring.gpg download
      get_url:
        url: https://brave-browser-apt-release.s3.brave.com/brave-browser-archive-keyring.gpg
        dest: /usr/share/keyrings/brave-browser-archive-keyring.gpg
   
    - name: Brave Browser PPA setting
      become: true
      shell: echo 'deb [signed-by=/usr/share/keyrings/brave-browser-archive-keyring.gpg arch=amd64] https://brave-browser-apt-release.s3.brave.com/ stable main' | tee /etc/apt/sources.list.d/brave-browser-release.list
   
    - name: Add KeepasXC stable repository from PPA and install its signing key on Debian target
      ansible.builtin.apt_repository:
        repo: "{{ item }}"
        state: present
      with_items: 
      - ppa:phoerious/keepassxc
      - ppa:tomtomtom/yt-dlp
   
    - name: install packages using apt
      become: true
      when: ansible_os_family == 'Debian'
      apt:
        name: "{{ item }}"
        state: present
        update_cache: true  
      with_items:
        - brave-browser
        - keepassxc 
        - restic
        - git
        - mc
        - vagrant
        - unattended-upgrades
        - tmux
        - zsh
        - neofetch
        - flatpak
        - wget 
        - pip
        - tree
        - nala
        - exa 
        - cifs-utils
        - davfs2 
        - alacritty
        - nnn
        - yt-dlp
        - micro
        
    - name:  insall software as flatpak 
      community.general.flatpak:
        name: "{{ item }}"
        state: present
        method: user 
      with_items:
          - ch.protonmail.protonmail-bridge
          - com.github.eneshecan.WhatsAppForLinux 
          - eu.betterbird.Betterbird
          - md.obsidian.Obsidian
          - org.onlyoffice.desktopeditors
          - com.nextcloud.desktopclient.nextcloud 
          - net.sourceforge.pdfchain   
          - org.tenacityaudio.Tenacity
   
    - name: install starship prompt 
      become: true 
      shell: 'curl -sS https://starship.rs/install.sh | sh'

    - name: clone tmux package manager TPM
      ansible.builtin.git:
        repo: 'https://github.com/tmux-plugins/tpm.git'
        dest: ~{{ remote_regular_user }}/.tmux/plugins/tpm

    - name: install zap for zsh plugin management 
      become: true 
      shell: zsh <(curl -s https://raw.githubusercontent.com/zap-zsh/zap/master/install.zsh) --branch release-v1
